window.ULNS=function(){function a(){}return a}();var extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;ULNS.User=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.initialize=function(){return ULNS.info("User model initialized")},b.prototype.validation={name:{required:!0,msg:"Пожалуйста, напишите имя пользователя"},phone:[{required:!0,msg:"Пожалуйста, напишите телефон"},{pattern:/^\+?([-. 0-9]{6,60})$/,msg:"Напишите, правильный телефон"}]},b}(Backbone.Model);var extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;ULNS.Users=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.model=ULNS.User,b.prototype.initialize=function(){return ULNS.info("Users collection initialized")},b}(Backbone.Collection);var extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;ULNS.UserAddView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.tagName="form",b.prototype.className="form-inline",b.prototype.template=function(){return ULNS.Templates.userAddView(this.model.toJSON())},b.prototype.events={"click .btn-add":"userAdd"},b.prototype.initialize=function(a){return ULNS.info("UserAddView initializing",a),this.listenTo(a.model,"change:errors",this.render),this.listenTo(a.model,"validated",this.validated),Backbone.Validation.bind(this)},b.prototype.render=function(){return ULNS.info("UserAddView rendering"),this.$el.html(this.template()),this},b.prototype.userAdd=function(a){return a.preventDefault(),this.model.set({name:this.$("#name").val(),phone:this.$("#phone").val()}),this.model.save()},b.prototype.validated=function(a,b,c){return a?(b.set({editing:!1}),b.unset("errors"),this.collection.add(b),this.collection.trigger("new:user:add")):this.model.set("errors",c)},b}(Backbone.View);var extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;ULNS.UserDetailView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.id="user-detail",b.prototype.tagName="tr",b.prototype.template=function(){return ULNS.Templates.userDetailView(this.model.toJSON())},b.prototype.events={"click .btn-edit":"userEdit","click .btn-save":"userSave","click .btn-remove":"userRemove","click .btn-cancel":"userCancel"},b.prototype.initialize=function(a){return ULNS.info("UserDetailView initializing",a),this.listenTo(a.model,"change:editing",this.render),this.listenTo(a.model,"change:errors",this.render),this.listenTo(a.model,"validated",this.validated),Backbone.Validation.bind(this)},b.prototype.render=function(){return ULNS.info("UserDetailView rendering"),this.$el.html(this.template()),this},b.prototype.userEdit=function(a){return ULNS.info(a),a.preventDefault(),this.model.set({editing:!0})},b.prototype.userSave=function(a){return a.preventDefault(),this.model.set({name:this.$("[name=name]").val(),phone:this.$("[name=phone]").val()}),this.model.save()},b.prototype.userRemove=function(a){return a.preventDefault(),this.model.destroy(),this.remove()},b.prototype.userCancel=function(a){return a.preventDefault(),this.model.set({editing:!1})},b.prototype.validated=function(a,b,c){return a?(b.set({editing:!1}),b.unset("errors")):this.model.set("errors",c)},b}(Backbone.View);var extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;ULNS.UserListView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.id="user-list",b.prototype.template=function(){return ULNS.Templates.userListView},b.prototype.initialize=function(a){return ULNS.info("UserListView initializing"),this.listenTo(a.collection,"add",this.renderUser),this.listenTo(a.collection,"new:user:add",this.renderUserAddView)},b.prototype.renderUserAddView=function(){var a;return a=new ULNS.UserAddView({collection:this.collection,model:new ULNS.User}),this.$("#user-add-form").html(a.render().el)},b.prototype.renderUser=function(a){var b;return b=new ULNS.UserDetailView({model:a}),this.$("tbody").append(b.render().el)},b.prototype.render=function(){return ULNS.info("UserListView rendering"),this.$el.html(this.template()),this.renderUserAddView(),this.collection.each(function(a){return function(b){return a.renderUser(b)}}(this)),this},b}(Backbone.View);var extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;ULNS.Router=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.routes={"":"root"},b.prototype.initialize=function(){return ULNS.log("Router init"),ULNS.app.events.t("router:init:end")},b.prototype.root=function(){return ULNS.log("init root route"),ULNS.app.root()},b}(Backbone.Router),ULNS.Events={t:function(a,b){return null==b&&(b={}),ULNS.log(6,"EVENT Triggered '"+a+"'",b),this.trigger(a,b)}},ULNS.App=function(){function a(){}return a.prototype.debug=0,a.prototype.events=_.extend(ULNS.Events,Backbone.Events),a.prototype.init=function(){return ULNS.log("App init"),this.events.t("init:start"),this.events.on("dom:onload",this.dom_onload,this),ULNS.root_view=new ULNS.UserListView({collection:new ULNS.Users}),this.events.on("init:dom:end",function(){return this.events.t("init:end")},this)},a.prototype.dom_onload=function(){return ULNS.log("DOM loaded, proceeding"),ULNS.app.dom_exists=!0,this.events.t("init:dom:start"),$("#main").append(ULNS.root_view.render().el),this.router=new ULNS.Router,this.events.t("init:dom:end")},a.prototype.root=function(){var a;return a=[{name:"Ivan Ivanov",phone:"111111111"},{name:"Petr Petrov",phone:"222222222"},{name:"Sergei Serov",phone:"333333333"},{name:"Ivan Ivanov",phone:"444444444"},{name:"Ivan Ivanov",phone:"555555555"}],ULNS.root_view.collection.url?ULNS.root_view.collection.fetch():ULNS.root_view.collection.add(a)},a}();var slice=[].slice;window.console||(window.console={}),console.log||(console.log=function(){}),console.warn||(console.warn=function(){}),console.error||(console.error=function(){}),console.info||(console.info=function(){}),ULNS.console_output=function(){var a,b,c,d,e,f;return a=Array.prototype.slice.call(arguments),e=a[0],a.shift(),e?a.length>1&&(c=parseInt(a[0]),[0,1,2,3,4,5,6].indexOf(c)>-1&&(a.shift(),ULNS.app.debug<c))?!1:(isNaN(c)&&(c=0),null==c&&(c=0),b=new Date,f=b.getUTCFullYear()+"-"+(b.getUTCMonth()+1)+"-"+b.getUTCDate()+"@"+b.getUTCHours()+":"+b.getUTCMinutes()+":"+b.getUTCSeconds()+"."+b.getUTCMilliseconds(),d=a[0],a.length>1?a.shift():a=[],console[e].apply(console,["["+c+":"+f+"] "+d].concat(slice.call(a))),!0):void 0},ULNS.log=function(){return ULNS.console_output.apply(ULNS,["log"].concat(slice.call(arguments)))},ULNS.info=function(){return ULNS.console_output.apply(ULNS,["info"].concat(slice.call(arguments)))},ULNS.warn=function(){return ULNS.console_output.apply(ULNS,["warn"].concat(slice.call(arguments)))},ULNS.error=function(){return ULNS.console_output.apply(ULNS,["error"].concat(slice.call(arguments)))},ULNS.app=new ULNS.App,ULNS.app.events.on("router:init:end",function(){return Backbone.history.start({pushState:!0})}),ULNS.app.init(),$(function(){return ULNS.app.events.t("dom:onload")}),this.ULNS=this.ULNS||{},this.ULNS.Templates=this.ULNS.Templates||{},this.ULNS.Templates.userAddView=Handlebars.template({1:function(a,b,c,d,e){return"has-error"},3:function(a,b,c,d,e){var f;return'  <span class="help-block">'+a.escapeExpression(a.lambda(null!=(f=null!=b?b.errors:b)?f.name:f,b))+"</span>\n"},5:function(a,b,c,d,e){var f;return'  <span class="help-block">'+a.escapeExpression(a.lambda(null!=(f=null!=b?b.errors:b)?f.phone:f,b))+"</span>\n"},compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f,g,h=c.helperMissing,i="function",j=a.escapeExpression;return'<div class="form-group col-md-5 '+(null!=(f=c["if"].call(b,null!=(f=null!=b?b.errors:b)?f.name:f,{name:"if",hash:{},fn:a.program(1,e,0),inverse:a.noop,data:e}))?f:"")+'">\n  <label for="name">Имя</label>\n  <input type="text" class="form-control" id="name" placeholder="Сергей Кузнецов" value="'+j((g=null!=(g=c.name||(null!=b?b.name:b))?g:h,typeof g===i?g.call(b,{name:"name",hash:{},data:e}):g))+'">\n'+(null!=(f=c["if"].call(b,null!=(f=null!=b?b.errors:b)?f.name:f,{name:"if",hash:{},fn:a.program(3,e,0),inverse:a.noop,data:e}))?f:"")+'</div>\n<div class="form-group col-md-5 '+(null!=(f=c["if"].call(b,null!=(f=null!=b?b.errors:b)?f.phone:f,{name:"if",hash:{},fn:a.program(1,e,0),inverse:a.noop,data:e}))?f:"")+'">\n  <label for="phone">Телефон</label>\n  <input type="email" class="form-control" id="phone" placeholder="7-871-501-11-12" value="'+j((g=null!=(g=c.phone||(null!=b?b.phone:b))?g:h,typeof g===i?g.call(b,{name:"phone",hash:{},data:e}):g))+'">\n'+(null!=(f=c["if"].call(b,null!=(f=null!=b?b.errors:b)?f.phone:f,{name:"if",hash:{},fn:a.program(5,e,0),inverse:a.noop,data:e}))?f:"")+'</div>\n<button type="submit" class="col-md-2 btn btn-default btn-add">Добавить</button>\n'},useData:!0}),this.ULNS.Templates.userDetailView=Handlebars.template({1:function(a,b,c,d,e){var f,g;return'    <div class="form-group '+(null!=(f=c["if"].call(b,null!=(f=null!=b?b.errors:b)?f.name:f,{name:"if",hash:{},fn:a.program(2,e,0),inverse:a.noop,data:e}))?f:"")+'">\n      <input name="name" class="form-control" placeholder="Сергей Кузнецов" value="'+a.escapeExpression((g=null!=(g=c.name||(null!=b?b.name:b))?g:c.helperMissing,"function"==typeof g?g.call(b,{name:"name",hash:{},data:e}):g))+'">\n'+(null!=(f=c["if"].call(b,null!=(f=null!=b?b.errors:b)?f.name:f,{name:"if",hash:{},fn:a.program(4,e,0),inverse:a.noop,data:e}))?f:"")},2:function(a,b,c,d,e){return"has-error"},4:function(a,b,c,d,e){var f;return'      <span class="help-block">'+a.escapeExpression(a.lambda(null!=(f=null!=b?b.errors:b)?f.name:f,b))+"</span>\n    </div>\n"},6:function(a,b,c,d,e){var f;return"    "+a.escapeExpression((f=null!=(f=c.name||(null!=b?b.name:b))?f:c.helperMissing,"function"==typeof f?f.call(b,{name:"name",hash:{},data:e}):f))+"\n"},8:function(a,b,c,d,e){var f,g;return'    <div class="form-group '+(null!=(f=c["if"].call(b,null!=(f=null!=b?b.errors:b)?f.phone:f,{name:"if",hash:{},fn:a.program(2,e,0),inverse:a.noop,data:e}))?f:"")+'">\n      <input name="phone" class="form-control" placeholder="7-871-501-11-12" value="'+a.escapeExpression((g=null!=(g=c.phone||(null!=b?b.phone:b))?g:c.helperMissing,"function"==typeof g?g.call(b,{name:"phone",hash:{},data:e}):g))+'">\n'+(null!=(f=c["if"].call(b,null!=(f=null!=b?b.errors:b)?f.phone:f,{name:"if",hash:{},fn:a.program(9,e,0),inverse:a.noop,data:e}))?f:"")+"    </div>\n"},9:function(a,b,c,d,e){var f;return'      <span class="help-block">'+a.escapeExpression(a.lambda(null!=(f=null!=b?b.errors:b)?f.phone:f,b))+"</span>\n"},11:function(a,b,c,d,e){var f;return"    "+a.escapeExpression((f=null!=(f=c.phone||(null!=b?b.phone:b))?f:c.helperMissing,"function"==typeof f?f.call(b,{name:"phone",hash:{},data:e}):f))+"\n"},13:function(a,b,c,d,e){return'    <a href="#" class="btn btn-default btn-save">Сохранить</a>\n    <a href="#" class="btn btn-danger btn-cancel">Отменить</a>\n'},15:function(a,b,c,d,e){return'    <a href="#" class="btn btn-default btn-edit">Редактировать</a>\n    <a href="#" class="btn btn-danger btn-remove">Удалить</a>\n'},compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f;return"<td>\n"+(null!=(f=c["if"].call(b,null!=b?b.editing:b,{name:"if",hash:{},fn:a.program(1,e,0),inverse:a.program(6,e,0),data:e}))?f:"")+"</td>\n<td>\n"+(null!=(f=c["if"].call(b,null!=b?b.editing:b,{name:"if",hash:{},fn:a.program(8,e,0),inverse:a.program(11,e,0),data:e}))?f:"")+"</td>\n<td>\n"+(null!=(f=c["if"].call(b,null!=b?b.editing:b,{name:"if",hash:{},fn:a.program(13,e,0),inverse:a.program(15,e,0),data:e}))?f:"")+"</td>\n"},useData:!0}),this.ULNS.Templates.userListView=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){return'<h2>User List Table</h2>\n<table class="table user-table">\n  <thead>\n    <tr>\n      <th width="40%">Имя</th>\n      <th width="40%">Телефон</th>\n      <th width="20%">Действия</th>\n    </tr>\n  </thead>\n  <tbody></tbody>\n  <tfoot></tfoot>\n</table>\n\n<div id="user-add-form"></div>\n'},useData:!0});